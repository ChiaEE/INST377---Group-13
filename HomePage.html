<html>
<head>
    <title>Book Database</title>
    <link rel="stylesheet" href="HomePage.css">
    <script src="search_page_stuff.js" defer></script>
</head>
<body style="background-color: #226ca1;">
    <!-- Header Section -->
    <header id="bar">
        <h1>Paramount Book Search</h1>
    </header>

    <nav id="main-nav">
        <ul id="navList">
            <li><a href="HomePage.html">HOME</a></li>
            <li><a href="About_page.html">ABOUT</a></li>
            <li id="childrensBooksLink"><a href="Children'sBooks.html">Children's Books</a></li>
            <li id="fictionBooksLink"><a href="FictionBooks.html">Fiction Books</a></li>
            <li id="nonFictionBooks"><a href="NonFictionBooks.html"> Non-Fiction Books </a></li>
            <li id="comedyBooksLink"><a href="ComedyBooks.html">Comedy Books</a></li>
            <li id="romanceBooksLink"><a href="RomanceBooks.html">Romance Books</a></li>
            <li id="dramaBooksLink"><a href="DramaBooks.html">Drama Books</a></li>
            <li id="sciBooksLink"><a href="ScienceBooks.html">Science Books</a></li>
            <li id="horrorBooksLink"><a href="HorrorBooks.html">Horror Books</a></li>
            <li id="mysteryBooksLink"><a href="MysteryBooks.html">Mystery Books</a></li>
            <li id="YABooksLink"><a href="YABooks.html">Young Adult Books</a></li>
        </ul>
    </nav>

    <div id="results"></div>
    <br><br><br>
    
    <!-- Search Bar -->
    <div class="search-container">
        <form onsubmit="performSearch(event)">
            <input type="text" class="search-input" placeholder="Search...">
            <button type="submit" class="search-button">Search</button>
        </form>
        <div id="loading-indicator" style="display: none;">Loading Results...</div>
    </div>

    <script type="text/javascript">
        function extractSecondPageStuff() {
            var secondPageBooks = new Object();
            /* Loop through the 32 pages of the websites and get the results array. */
            for(let i = 1; i < 32; i++) {
                var pageIndicator = "Page".concat(" ", i);
                fetch("https://gutendex.com/books/?page=" + i)
                    .then((res) => res.json())
                    .then((res) => {
                        for(var key of Object.keys(res)) {
                            if(Object.prototype.hasOwnProperty.call(res, key)) {
                                if(key == "results") {
                                    // Map the page number to the results. 
                                    secondPageBooks[pageIndicator] = res[key];
                                }
                            }
                        }
                    });
            }
            console.log("Pages 1-32 details: ", secondPageBooks);
        }

        window.onload = extractSecondPageStuff;
    </script>


    <script>

        function performSearch(event) {
            event.preventDefault();

            let searchItem = document.querySelector(".search-input").value;
            var booksDetails = [];

            document.getElementById("loading-indicator").style.display = "block";

            // This code extracts the data from the first page of the Gutendex API. 
            fetch("https://gutendex.com/books")
            .then((res) => res.json())
            .then((res) => {
                for(var key of Object.keys(res)) {
                    if(Object.prototype.hasOwnProperty.call(res, key)) {
                        // If the key is results, we add all the details to the bookDetails Array.
                        if(key === "results") {
                            booksDetails.push(...res[key]);
                        }
                    }
                }
            

                const searchResults = booksDetails.filter(book =>{
                    return book.title.toLowerCase().includes(searchItem.toLowerCase());
                });

            document.getElementById("loading-indicator").style.display = "none";

            window.location.href = "search_results_page.html?query=" + encodeURIComponent(searchItem) + "&results=" + encodeURIComponent(JSON.stringify(searchResults));
        });
    }

    </script>

</body>
</html>


    
    